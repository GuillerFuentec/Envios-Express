import{A as K,g as U}from"./env-CiJp0Il3.js";/* empty css               */const M=(e,t,r={})=>fetch(`${K}${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:t,...r})}),C=new Map;let k;const G=()=>k||(typeof window>"u"?(k=Promise.reject(new Error("reCAPTCHA solo funciona en el navegador.")),k):(k=new Promise((e,t)=>{if(window.grecaptcha){e(window.grecaptcha);return}const r=document.createElement("script");r.src="https://www.google.com/recaptcha/api.js?render=explicit",r.async=!0,r.defer=!0,r.onload=()=>{window.grecaptcha?e(window.grecaptcha):t(new Error("No se pudo inicializar reCAPTCHA."))},r.onerror=()=>t(new Error("No se pudo cargar reCAPTCHA. Verifica tu conexion.")),document.head.appendChild(r)}),k)),Q=(e,t)=>{const r=U();if(!r)throw new Error("Falta la llave publica de reCAPTCHA.");G().then(s=>{const c=C.get(t);if(c){s.reset(c.widgetId),c.token="";return}const m=s.render(e,{sitekey:r,callback:n=>{const u=C.get(t);u&&(u.token=n)},"expired-callback":()=>{const n=C.get(t);n&&(n.token="")},"error-callback":()=>{const n=C.get(t);n&&(n.token="")}});C.set(t,{widgetId:m,token:""})}).catch(s=>{console.error("[recaptcha] No se pudo montar el widget",s)})},j=(e,t)=>{if(typeof document>"u")return;const r=typeof e=="string"?document.querySelector(e):e;r&&Q(r,t)},J=e=>{const t=C.get(e);if(!t||!t.token)throw new Error("Completa el captcha para continuar.");return t.token},N=e=>{const t=C.get(e);t&&typeof window<"u"&&window.grecaptcha&&(window.grecaptcha.reset(t.widgetId),t.token="")},X=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,Z=/^\+?[0-9\s-]{7,}$/,W=({name:e="",email:t="",phone:r=""})=>{const s=e.trim(),c=t.trim(),m=r.trim();return s.length<3?{valid:!1,message:"Ingresa un nombre valido (al menos 3 caracteres).",field:"contact.name"}:X.test(c)?Z.test(m)?{valid:!0}:{valid:!1,message:"Ingresa un telefono valido (incluye codigo de pais).",field:"contact.phone"}:{valid:!1,message:"Ingresa un correo valido.",field:"contact.email"}},ee="/api/clients",te=e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,ne=(e,t)=>(r=!1)=>{if(!e||!t)return;const s=e.getAttribute("aria-expanded")==="true",c=r?!1:!s;e.setAttribute("aria-expanded",c?"true":"false"),c?(t.hidden=!1,t.removeAttribute("hidden")):(t.hidden=!0,t.setAttribute("hidden",""))},oe=(e,t,r=300)=>{const s=t-e;let c=null;const m=n=>{c===null&&(c=n);const u=n-c,w=Math.min(u/r,1),l=te(w);window.scrollTo(0,e+s*l),u<r&&window.requestAnimationFrame(m)};window.requestAnimationFrame(m)},re=()=>{const e=document.querySelector(".site-navbar"),t=e?e.querySelector(".site-navbar__toggle"):null,r=e?e.querySelector("#mobile-menu"):null,s=document.querySelectorAll('[data-scroll="true"]'),c=ne(t,r);t&&t.addEventListener("click",()=>c(!1));const m=function(l){const y=this.getAttribute("href");if(!y||!y.startsWith("#"))return;const b=document.querySelector(y);if(!b)return;l.preventDefault();const d=e&&e.offsetHeight||0,i=b.getBoundingClientRect().top+window.pageYOffset-(d+12);oe(window.pageYOffset,i),c(!0)};s.forEach(l=>{l.addEventListener("click",m)});const n=Array.from(s).map(l=>{const y=l.getAttribute("href");return y&&y.startsWith("#")?document.querySelector(y):null}).filter(Boolean),u=()=>{if(!n.length)return;const l=e&&e.offsetHeight||0,y=window.pageYOffset+l+24;let b=n[0];n.forEach(i=>{i.offsetTop<=y&&(b=i)});const d=b.id;s.forEach(i=>{i.getAttribute("href")===`#${d}`?i.classList.add("is-active"):i.classList.remove("is-active")})};let w=!1;window.addEventListener("scroll",()=>{w||(window.requestAnimationFrame(()=>{u(),w=!1}),w=!0)}),u()},ae=()=>{const e=document.getElementById("funnelForm");if(!e)return;const t=Array.from(e.querySelectorAll("[data-funnel-step]")),r=document.querySelector("[data-funnel-step-label]"),s=document.querySelector("[data-funnel-progress]"),c=e.querySelector("[data-funnel-summary]"),m=c?c.querySelector(".funnel__summary-body"):null,n=e.querySelector("[data-funnel-prev]"),u=e.querySelector("[data-funnel-next]"),w=document.getElementById("funnelStatus"),l=e.querySelector('[data-field="preferences.paymentPreference"]'),y=e.querySelectorAll("[data-payment-choice]"),b=e.querySelectorAll("[data-payment-action]"),d=e.querySelector('[data-payment-action="online"]');j('[data-recaptcha="funnel"]',"funnel_form");let i=0;const q=t.length||1;let L=null,p=null,_=!1;const g={contact:{name:"",email:"",phone:"",smsConsent:!1},shipment:{weight:"",city:"",mode:"",content:""},preferences:{targetDate:"",pickupAddress:"",notes:"",paymentPreference:"sin_definir"}},x={online:"Pago en linea (Stripe)",cod:"Pago al entregar",sin_definir:"Pendiente de confirmacion"},A=(o,a="info")=>{w&&(w.textContent=o||"",w.classList.remove("is-success","is-error"),a==="error"&&w.classList.add("is-error"),a==="success"&&w.classList.add("is-success"))},B=(o,a,S)=>{if(!a)return;const v=a.split(".");let h=o;v.forEach((f,E)=>{if(E===v.length-1){h[f]=S;return}(!h[f]||typeof h[f]!="object")&&(h[f]={}),h=h[f]})},D=o=>{l&&(l.value=o),B(g,"preferences.paymentPreference",o),y.forEach(a=>{const S=a.getAttribute("data-payment-choice");a.classList.toggle("is-selected",S===o)})},I=o=>{const a=t[o];if(!a)return;a.querySelectorAll("[data-field]").forEach(v=>{const h=v.getAttribute("data-field");if(!h)return;const f=v.type==="checkbox"?v.checked:v.value.trim();B(g,h,f)})},O=()=>{if(!m)return;const a=[{label:"Nombre",value:g.contact.name||"No indicado"},{label:"Correo",value:g.contact.email||"No indicado"},{label:"Telefono",value:g.contact.phone||"No indicado"},{label:"Recibir SMS",value:g.contact.smsConsent?"Si, autorizado":"Sin autorizacion"},{label:"Peso estimado",value:g.shipment.weight?`${g.shipment.weight} lb`:"No indicado"},{label:"Destino",value:g.shipment.city||"No indicado"},{label:"Tipo de envio",value:g.shipment.mode||"No indicado"},{label:"Contenido",value:g.shipment.content||"No indicado"},{label:"Fecha ideal",value:g.preferences.targetDate||"No indicado"},{label:"Direccion de recogida",value:g.preferences.pickupAddress||"No indicado"},{label:"Notas",value:g.preferences.notes||"Sin notas"},{label:"Metodo de pago",value:x[g.preferences.paymentPreference]||x.sin_definir}].map(S=>`
          <dt>${S.label}</dt>
          <dd>${S.value}</dd>
        `).join("");m.innerHTML=`<dl class="funnel__summary-list">${a}</dl>`},R=o=>{b.forEach(a=>{a.disabled=o,a.classList.toggle("is-disabled",o)})},$=()=>{if(t.forEach((o,a)=>{o.classList.toggle("is-active",a===i)}),r&&(r.textContent=String(i+1)),s){const o=(i+1)/q*100;s.style.width=`${o}%`}if(n){const o=i===0;n.disabled=o,n.classList.toggle("is-disabled",o)}u&&(u.hidden=i>=q-1)},F=o=>{o<0||o>=q||(i=o,$(),i===q-1&&(I(i),O()),A(""))},H=o=>{var v,h,f;const a=t[o];if(!a)return!0;const S=a.querySelectorAll("input, select, textarea");for(const E of S)if(!E.checkValidity())return E.reportValidity(),!1;if(o===0){const E=((v=a.querySelector('[data-field="contact.name"]'))==null?void 0:v.value)||"",V=((h=a.querySelector('[data-field="contact.email"]'))==null?void 0:h.value)||"",Y=((f=a.querySelector('[data-field="contact.phone"]'))==null?void 0:f.value)||"",T=W({name:E,email:V,phone:Y});if(!T.valid){A(T.message,"error");const P=a.querySelector(`[data-field="${T.field}"]`);return P==null||P.focus(),!1}}return!0},z=o=>{L=o,D(o==="cod"?"cod":"online"),o==="online"&&(p=window.open("","_blank","noopener"),p&&p.document.write('<p style="font-family:monospace;padding:16px;">Preparando checkout seguro...</p>')),typeof e.requestSubmit=="function"?e.requestSubmit():e.dispatchEvent(new Event("submit",{cancelable:!0}))};u&&u.addEventListener("click",()=>{H(i)&&(I(i),F(i+1))}),n&&n.addEventListener("click",()=>{F(i-1)}),b.length&&b.forEach(o=>{o.addEventListener("click",()=>{const a=o.getAttribute("data-payment-action");a&&z(a)})}),D((l==null?void 0:l.value)||"sin_definir"),e.addEventListener("submit",async o=>{if(o.preventDefault(),_)return;if(!L){A("Selecciona como deseas continuar.","error");return}if(!H(i)){p&&!p.closed&&p.close(),p=null,L=null;return}I(i),O();const a=JSON.parse(JSON.stringify(g));let S="";try{S=await J("funnel_form")}catch(f){console.error("[funnel] No se pudo obtener reCAPTCHA",f),A("No pudimos verificar que eres humano. Intenta nuevamente.","error"),N("funnel_form"),p&&!p.closed&&(p.close(),p=null),L=null;return}A("Registrando tu informacion..."),R(!0),_=!0;const v=L;let h=!1;try{localStorage.setItem("funnelDraft",JSON.stringify(a))}catch(f){console.warn("No se pudo guardar el funnel en localStorage",f)}try{const f=await M(ee,{client_info:a},{captchaToken:S});if(!f.ok)throw new Error(`Respuesta inesperada (${f.status})`);if(h=!0,v==="online"){A("Informacion guardada. Abriendo el checkout seguro...","success");const E=(d==null?void 0:d.getAttribute("data-checkout-url"))||"./src/pages/checkout.html";window.setTimeout(()=>{p&&!p.closed?p.location.href=E:window.open(E,"_blank","noopener")},400)}else A("Listo. Te enviaremos un SMS para confirmar el pago contra entrega.","success")}catch(f){console.error("Error al enviar el funnel",f),A("No se pudo enviar la informacion. Intentalo de nuevo mas tarde.","error")}finally{p&&(!h||v!=="online")&&(p.close(),p=null),h&&v==="online"&&(p=null),L=null,_=!1,R(!1),N("funnel_form")}}),$(),window.feather&&typeof window.feather.replace=="function"&&window.feather.replace()};document.addEventListener("DOMContentLoaded",()=>{re(),ae()});const se="/api/contacts",ie=()=>{const e=document.getElementById("contactForm");if(!e)return;const t=document.getElementById("contactName"),r=document.getElementById("contactEmail"),s=document.getElementById("contactPhone"),c=document.getElementById("contactMessage"),m=document.getElementById("contactSmsConsent"),n=document.getElementById("contactStatus"),u=e.querySelector('button[type="submit"]');j('[data-recaptcha="contact"]',"contact_form"),e.addEventListener("submit",async w=>{w.preventDefault();const l=W({name:(t==null?void 0:t.value)||"",email:(r==null?void 0:r.value)||"",phone:(s==null?void 0:s.value)||""});if(!l.valid){n&&(n.textContent=l.message,n.classList.remove("is-success"),n.classList.add("is-error"));let d=null;l.field==="contact.name"?d=t:l.field==="contact.email"?d=r:l.field==="contact.phone"&&(d=s),d==null||d.focus();return}if(m&&!m.checked){n&&(n.textContent="Necesitamos tu autorizacion para enviarte mensajes de texto.",n.classList.remove("is-success"),n.classList.add("is-error")),m.focus();return}let y="";try{y=await J("contact_form")}catch(d){console.error("[contact] No se pudo obtener reCAPTCHA",d),n&&(n.textContent="No pudimos verificar que eres humano. Intenta nuevamente.",n.classList.remove("is-success"),n.classList.add("is-error")),N("contact_form");return}n&&(n.textContent="Enviando mensaje...",n.classList.remove("is-success","is-error")),u&&(u.disabled=!0,u.textContent="Enviando...");const b={name:(t==null?void 0:t.value.trim())||"",email:(r==null?void 0:r.value.trim())||"",phone:(s==null?void 0:s.value.trim())||"",message:(c==null?void 0:c.value.trim())||"",smsConsent:!!(m!=null&&m.checked),sentAt:new Date().toISOString()};try{const d=await M(se,{contact_info:b},{captchaToken:y});if(!d.ok)throw new Error(`Respuesta inesperada (${d.status})`);n&&(n.textContent="Gracias por escribirnos. Te responderemos muy pronto.",n.classList.add("is-success")),e.reset(),N("contact_form")}catch(d){console.error("Error al enviar el contacto",d),n&&(n.textContent="No pudimos enviar tu mensaje. Intentalo nuevamente.",n.classList.add("is-error"))}finally{u&&(u.disabled=!1,u.textContent="Enviar mensaje"),N("contact_form")}})};document.addEventListener("DOMContentLoaded",ie);
